<!DOCTYPE html>
<html>
<head>
    <title>Debug Journal</title>
</head>
<body>
    <h1>Debug Journal - Consola</h1>
    <div id="status">Verificando conexi√≥n...</div>
    <div id="websocket-status">WebSocket: Desconectado</div>
    <div id="data-status">Datos: No recibidos</div>
    
    <script>
        // Verificar conexi√≥n WebSocket
        const wsUrl = `ws://${window.location.host}/ws/journal`;
        console.log('üîå Intentando conectar a:', wsUrl);
        
        const ws = new WebSocket(wsUrl);
        
        ws.onopen = () => {
            console.log('‚úÖ WebSocket conectado exitosamente');
            document.getElementById('websocket-status').textContent = 'WebSocket: Conectado';
            
            // Solicitar datos
            ws.send(JSON.stringify({ broker: 'all', days: 30 }));
            ws.send(JSON.stringify({ broker: 'schwab', days: 30 }));
            ws.send(JSON.stringify({ broker: 'coinbase', days: 30 }));
        };
        
        ws.onmessage = (event) => {
            try {
                const message = JSON.parse(event.data);
                console.log('üì® Datos recibidos:', message);
                document.getElementById('data-status').textContent = `Datos: Recibidos (${message.broker || 'all'})`;
                
                // Verificar si hay datos de evoluci√≥n para gr√°ficos
                if (message.data && message.data.evolution) {
                    console.log('üìä Datos de evoluci√≥n encontrados:', message.data.evolution.length, 'puntos');
                }
                
                if (message.data && message.data.stats) {
                    console.log('üìà Stats encontrados:', message.data.stats);
                }
                
            } catch (error) {
                console.error('‚ùå Error procesando mensaje:', error);
            }
        };
        
        ws.onerror = (error) => {
            console.error('‚ùå Error WebSocket:', error);
            document.getElementById('websocket-status').textContent = 'WebSocket: Error';
        };
        
        ws.onclose = () => {
            console.log('üîå WebSocket cerrado');
            document.getElementById('websocket-status').textContent = 'WebSocket: Cerrado';
        };
        
        // Verificar si Chart.js est√° cargado
        setTimeout(() => {
            if (typeof Chart !== 'undefined') {
                console.log('‚úÖ Chart.js est√° cargado correctamente');
            } else {
                console.error('‚ùå Chart.js NO est√° cargado');
            }
        }, 2000);
    </script>
</body>
</html>